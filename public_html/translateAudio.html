<html>
<head>
<!--<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>-->
<meta name="viewport" content="width=device-width">
        <link rel="stylesheet" href="themes/jac-theme1.min.css" />
        <link rel="stylesheet" href="themes/jquery.mobile.icons.min.css" />
        <link rel="stylesheet" href="jquery.mobile.structure-1.4.2.min.css" /> 
        <script src="jquery-1.8.2.min.js"></script>
        <script src="jquery.mobile-1.4.2.min.js"></script>
        <!--<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>-->
        <script type="text/javascript">
            document.write('<link rel="apple-touch-startup-image" href="images/startup'+(navigator.platform=='iPad'?'_ipad':'')+'.jpg">');
          </script>
        <link rel="apple-touch-icon" href="images/icon.png"/>
<script language="javascript">
    
    
 function ajaxTranslateCallback(response) {
  // Display translated text in the right textarea.
  $("#audio").attr('src', response);
$("#audio").trigger('load');
$("#audio").trigger('play');
}
   
    
    
    
    $(document).ready(function() {
var g_token = '';
onLoad();

function onLoad() {
  // Get an access token now.  Good for 10 minutes.
  getToken();
  // Get a new one every 9 minutes.
  setInterval(getToken, 9 * 60 * 1000);
}

            $.ajaxSetup({   
                beforeSend: function() {
//                     $loading.show();
                     console.log("ajaxstart");
                  },
                  complete: function(){
//                     $loading.hide();
                     console.log("ajaxend");
                  },
                  error: function(jqXHR, textStatus, errorThrown){
//                      $(".e-word").css("background-color", colorBackground);  
//                      $loading.hide();
//                      alert("Error, try again/intente otra vez");
                      alert("An error occured: " + textStatus + " " + errorThrown);
                  },
                async: false
                });

function getToken() {
  var requestStr = "./token.php";

  $.ajax({
    url: requestStr,
    type: "GET",
    cache: true,
    dataType: 'json',
    success: function (data) {
      g_token = data.access_token;
    }
  });
}

function translate(text, from, to) {
  var p = new Object;
  p.text = text;
  p.format = "audio/mp3";
  p.language = from;
  p.options = "MinSize";

  // A major puzzle solved.  Who would have guessed you specify the jsonp callback in oncomplete?
//  p.oncomplete = 'ajaxTranslateCallback';
  
 // Another major puzzle.  The authentication is supplied in the deprecated appId param.
  p.appId = "Bearer " + g_token;

  var requestStr = "http://api.microsofttranslator.com/V2/Ajax.svc/Speak";

  $.ajax({
    url: requestStr,
    type: "GET",
    data: p,
    dataType: 'jsonp',
    jsonp: 'oncomplete',
    jsonpCallback:'ajaxTranslateCallback',
    cache: true,
    async: false
  });
}

 $("#translateButton").on("click", function(){
     translateSourceTarget()
 });
 
 $("#playNow").on("click", function(){
     $("#audio").trigger('play');
 });
 
function ajaxTranslateCallback(response) {
  // Display translated text in the right textarea.
  $("#audio").attr('src', response);
//$("#audio").trigger('load');
$("#audio").trigger('play');
}

function translateSourceTarget() {
  // Translate the text typed by the user into the left textarea.
  var src = $("#source").val();
  translate(src, "en", "fr");
}
    });
</script>
<style>
#source, #target {
  position:relative;
  float:left;
  width:400px;
  height: 50px;
  padding:10px;
  margin: 10px;
  border: 1px solid black;
}

#translateButton {
  float:left;
  margin: 10px;
  height:50px;
}
</style>
</head>

<body>
<!--<body onload="onLoad();">-->

<textarea id="source">Text typed here will be spokenn.</textarea>
<button id="translateButton" >Speak!</button>
<button id="playNow" >play!</button>
<!--<button id="translateButton" onclick="translateSourceTarget();">Translate English to French</button>-->
<!--<textarea id="target"></textarea>-->
<audio id="audio" src="test.mp3"  type="audio/mp3"></audio>

</body>
</html>