<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<!--<html manifest="top-vocab.manifest">-->
<html>
    <head>
        <meta http-equiv="content-type" content="text/html;charset=utf-8" />        
        <meta name="apple-mobile-web-app-status-bar-style" content="black" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <!--<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>-->
        <title>Top 1K Vocab</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width">
        <link rel="stylesheet" href="themes/jac-theme1.min.css" />
        <link rel="stylesheet" href="themes/jquery.mobile.icons.min.css" />
        <link rel="stylesheet" href="jquery.mobile.structure-1.4.2.min.css" /> 
        <script src="jquery-1.8.2.min.js"></script>
        <script src="jquery.mobile-1.4.2.min.js"></script>
        <!--<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>-->
        <script type="text/javascript">
            document.write('<link rel="apple-touch-startup-image" href="images/startup'+(navigator.platform=='iPad'?'_ipad':'')+'.jpg">');
          </script>
        <link rel="apple-touch-icon" href="images/icon.png"/>


        <script>
            // Bypass Access-Control-Allow-Origin
//            $.support.cors = true;
//            $.mobile.allowCrossDomainPages = true;
            var speakUrl = "/test.mp3";
            
            function ajaxTranslateCallback(response) {
              speakUrl = response;
//              console.log("got bing callback");
            }
//            
      
            
            $(document).ready(function() {
            
//            var audio = new Audio();  
            var audio = $('#audio');
            var sWord; 
            var xml; 
            var ajaxFlag = false;
            var parser = new DOMParser();
            var $loading = $('#loadingImg').hide();
            var colorBackground;
            var language = "en-us";
            var elementsArray;
            var loadXMLFlag = false;
            var flashcardIndexArray = new Array();
            var indexArrayFilledFlag = false;
            var playFlag = false;
            var flashcardIndex = 0;
            var shiftedIndex = 0;
//            var speakUrl = "/test.mp3";
            online = window.navigator.onLine;
            var g_token = '';
            // Bypass Access-Control-Allow-Origin
//            $.support.cors = true;
//            $.mobile.allowCrossDomainPages = true;
            
            
            // Get an access token now.  Good for 10 minutes.
              getToken();
              // Get a new one every 9 minutes.
              setInterval(getToken, 9 * 60 * 1000);

            function getToken() {
              var requestStr = "./token.php";

              $.ajax({
                url: requestStr,
                type: "GET",
                cache: true,
                dataType: 'json',
                success: function (data) {
                  g_token = data.access_token;
                }
              });
//              console.log("got bing token");
            }
            

              function getSpeakUrl(word) {
              var p = new Object;
              p.text = word;
              p.format = "audio/mp3";
              p.language = "en";
              p.options = "MinSize";

              // A major puzzle solved.  Who would have guessed you specify the jsonp callback in oncomplete?
//              p.oncomplete = 'ajaxTranslateCallback';

             // Another major puzzle.  The authentication is supplied in the deprecated appId param.
              p.appId = "Bearer " + g_token;

              var requestStr = "http://api.microsofttranslator.com/V2/Ajax.svc/Speak";

              $.ajax({
                url: requestStr,
                type: "GET",
                data: p,
                dataType: 'jsonp',           
                jsonp: 'oncomplete',
                jsonpCallback:'ajaxTranslateCallback',
                cache: true,
                async: false,
//                success: function (data) {
////                  speakUrl = data;
//                var fullLink = speakUrl;
//                  console.log("got speak link");
//                $('#audio').attr("src", fullLink);                
//                    $("#audio").trigger('load');
////                    $("#audio").trigger('play'); 
//
//
////                $("#audio").bind("load",function(){
//                console.log($('#audio').attr("src"));
//                   $("#audio").trigger('play');
////                });                  
//                }
              });
            }         
                    
        
            if (navigator.onLine) {
//              alert('you are online');
              $(".needConnection").show();
              $("#btnPlayEng").attr("data-icon","audio");
            } else {
              $(".needConnection").hide();
              $("#btnPlayEng").attr("data-icon","delete");
            }
            


            $.ajaxSetup({   
                beforeSend: function() {
                     $loading.show();
//                     console.log("ajaxstart");
                  },
                  complete: function(){
                     $loading.hide();
//                     console.log("ajaxend");
                  },
                  error: function(jqXHR, textStatus, errorThrown){
                      $(".e-word").css("background-color", colorBackground);  
                      $loading.hide();
//                      alert("Error, try again/intente otra vez");
                      alert("An error occured: " + textStatus + " " + errorThrown);
                  },
                async: false
                });
        
            $("#btnPlay").on("click", function(){
                 
                sWord = $("#word").val();
                language = "en-us";
                //check for null
                if (!sWord){
                   language = "es-mx"; 
                   sWord = "entre palabra";
                };
                //Play Audio                
                playWordLink(sWord);
             });
             
            
             
            $("#btnWords").click(function(){
                 fillWordGrid();
                $.mobile.changePage($("#word_list"), "none");
            });
            
            
            $("#englishSide").on("swipeleft",function(){
              $("body").pagecontainer("change", "#spanishflashcard", { transition: "flip" });
            });
            $("#spanishSide").on("swipeleft",function(){
                $("body").pagecontainer("change", "#englishflashcard", { transition: "flip" });
            });
            $("#englishSide").on("swiperight",function(){
              $("body").pagecontainer("change", "#spanishflashcard", { transition: "flip", reverse: true });
            });
            $("#spanishSide").on("swiperight",function(){
                $("body").pagecontainer("change", "#englishflashcard", { transition: "flip", reverse: true });
            });
                
            function playWordLink(link)
            {
               $loading.show();
//               var fullLink = "http://translate.google.com/translate_tts?tl=en&q=" + encodeURI(link); //google translate
//               var fullLink = "http://tts-api.com/tts.mp3?q=" + encodeURI(link); //"Powered by TTS-API.COM"
//               var fullLink = "http://api.voicerss.org/?&key=ab912f6a48934df8a324ffdee99c70db&hl="+ language +"&src=" + encodeURI(link); //"Powered by voicerss"
//               var fullLink = "http://api.naturalreaders.com/v2/tts/?t=%22"+ encodeURI(link) +"%22&r=26&s=1&requesttoken=00a59c5aefbfc4187e71218ed1259188"; //natural readers
//               var fullLink ="http://api.microsofttranslator.com/V2/Ajax.svc/Speak?language=en&text=" + encodeURI(link) + "&appId=Bearer" + encodeURI(g_token);
//               var fullLink ="http://api.microsofttranslator.com/V2/Http.svc/Speak?language=en&text=" + encodeURI(link) + "&appId=Bearer%20" + encodeURI(g_token);
               getSpeakUrl(link);
               var fullLink = speakUrl;
//              
//                if ( fullLink == $('#audio').attr("src")){
////                    $('#audio').attr("currenTime", 0);
//                    $("#audio").trigger('load');
//                    $("#audio").trigger('play');
//                } else {
               $('#audio').attr("src", fullLink);                
               $("#audio").trigger('load');
               $("#audio").trigger('play'); 
//
//
//                $("#audio").bind("load",function(){
//                console.log("audio loaded");
//                   $("#audio").trigger('play');
//                });
//                    playFlag = true;
//               console.log(audio.get(0).src);
//                }               
            }
            
            $("#wordGrid").on("click",".e-word",function(){
//                console.log($(this).text());
                colorBackground = $(this).css("background-color");
                $(this).css("background-color", "#E74C3C");
                language = "en-us";
                playWordLink($(this).text());
              });
            
            $("#audio").bind("ended",function(){
              $(".e-word").css("background-color", colorBackground);  
              $loading.hide();
            });
            

        function loadXMLDoc (){ 
            $.ajax({
                    type: "GET",
                    async: false,
                    url: "TopEnglishVocab.xml",
                    dataType: "text",
                    success: function(data) {xml=data;}
            });

           var xmlDoc = parser.parseFromString(xml , "text/xml");

           elementsArray = xmlDoc.documentElement.getElementsByTagName('word');
           loadXMLFlag = true;
        }
        
        function fillWordGrid(){
            
                if (loadXMLFlag === false) {
                    loadXMLDoc();
                }
                    
               var startPointer = $('#rankGroup').val()-200;
               var arrayLength = $('#rankGroup').val();
               //console.log(arrayLength);
               //create grid header
               var output="<div class='ui-block-a ui-bar-a' ><span>Rango: Spanish</span></div><div class='ui-block-b ui-bar-a' ><span >Ingles</span></div>";
    //           var output="<div class='ui-block-a ui-bar-a' ><span>Rango</span></div><div class='ui-block-b ui-bar-a' ><span>Espanol</span></div><div class='ui-block-c ui-bar-a' ><span >Ingles</span></div>";

           for(var i=startPointer; i < arrayLength; i++)
           {
                var rank = elementsArray[i].getElementsByTagName('rank')[0].firstChild.nodeValue;
                var spanish = elementsArray[i].getElementsByTagName('spanish')[0].firstChild.nodeValue;
                var english = elementsArray[i].getElementsByTagName('english')[0].firstChild.nodeValue;
                
                output += "<div class='ui-block-a' style='border:1px solid lightgray;'><span>"+ rank +":<br>  "+ spanish +"</span></div>";
                
                if (navigator.onLine) {
                    output += "<div class='ui-block-b e-word ui-link'  style='border:1px solid lightgray; color:#2980B9;'><span><br>"+ english +"</span></div>" ;
                } else {
                   output += "<div class='ui-block-b ui-link'  style='border:1px solid lightgray;'><span><br>"+ english +"</span></div>" ;
               }
//                output += "<div class='ui-block-a' style='border:1px solid lightgray;'><span>"+ rank +"</span></div>";
//                output += "<div class='ui-block-b' style='border:1px solid lightgray;'><span>"+ spanish +"</span></div>";
//                output += "<div class='ui-block-c e-word ui-link'  style='border:1px solid lightgray; text-decoration:underline; color:#2980B9;'><span>"+ english +"</span></div>" ;
//                output += "<div e-word='" + english + "'class='ui-block-c'  style='border:1px solid lightgray;'><span>"+ english +"</span></div>" ;
//                console.log(rank + " " + spanish + " " + english)
           }
            $( "#wordGrid" ).html( output );
        }
        
                
        $("#btnFcards").click(function(){
            if (loadXMLFlag === false) {
                    loadXMLDoc();
             }   
             
            if (indexArrayFilledFlag === false){
                fillFlashcardIndexArray();
            } 
            switchFlashcard("next");
//            $.mobile.changePage($("#englishflashcard"), "none");
            $("body").pagecontainer("change", "#englishflashcard");
            
         });
         
         function switchFlashcard(direction){
             if (direction === "next"){
                 if (flashcardIndex === 199){
                     flashcardIndex = 0;
                 }else{
                     flashcardIndex += 1;
                 }                     
             }
             if (direction === "previous"){
                 if (flashcardIndex === 0){
                     flashcardIndex = 199;
                 }else{
                     flashcardIndex -=1;
                 }                     
             }
             
             shiftedIndex = flashcardIndexArray[flashcardIndex]  + Number($('#rankGroup').val()) - 200;
//             console.log(Number($('#rankGroup').val()));
//             console.log(flashcardIndex);
//             console.log(shiftedIndex);
             var spanish = elementsArray[shiftedIndex].getElementsByTagName('spanish')[0].firstChild.nodeValue;
             var english = elementsArray[shiftedIndex].getElementsByTagName('english')[0].firstChild.nodeValue;
             $( "#englishWord" ).html( english );
             $( "#spanishWord" ).html( spanish );
         }
         
        $("#btnPlayEng").on("click", function(){
            if (navigator.onLine) {               
                language = "en-us";
                sWord= $( "#englishWord" ).html();
                //Play Audio                
                playWordLink(sWord);
             } else {
                 alert('no tiene internet!');
            }   
         });
         
        $("#btnPrev").on("click", function(){
//            switchFlashcard("prev");
            $("body").pagecontainer("change", "#englishflashcard",{ transition:"slidedown", changeHash:"false"});
            $( "#englishWord" ).show();
            $( "#spanishWord" ).hide();
            switchFlashcard("previous");
             
        });
        
        $("#btnNext").on("click", function(){
//            switchFlashcard("next");
            $("body").pagecontainer("change", "#englishflashcard",{ transition:"slideup", changeHash:"false"});
            $( "#englishWord" ).show();
            $( "#spanishWord" ).hide();                    
            switchFlashcard("next");
    });
        $("#btnEPrev").on("click", function(){
            $( "#englishWord" ).hide();
            $( "#spanishWord" ).show();              
            $("body").pagecontainer("change", "#englishflashcard",{ transition:"slidedown", allowSamePageTransition:"true"});
            switchFlashcard("previous");
            $( "#englishWord" ).show();
        });
        
        $("#btnENext").on("click", function(){
            $( "#englishWord" ).hide();
            $( "#spanishWord" ).show(); 
            $("body").pagecontainer("change", "#englishflashcard",{ transition:"slideup", allowSamePageTransition:"true" });
            switchFlashcard("next");
            $( "#englishWord" ).show();
        });
        
        $(".btnFlip").on("click", function(){
            var activePage =$("body").pagecontainer("getActivePage").attr( 'id' );
            if(activePage === "englishflashcard"){
                $("body").pagecontainer("change", "#spanishflashcard",{ transition:"flip", changeHash:"false"});
                $( "#spanishWord" ).show();
            } 
            if(activePage === "spanishflashcard"){
                $("body").pagecontainer("change", "#englishflashcard",{ transition:"flip", changeHash:"false"});
                $( "#englishWord" ).show();
            } 
        });
        
        function fillFlashcardIndexArray(){
            for (var i = 0; i < 200; i++){
                flashcardIndexArray[i] = i + 1;
            }
            shuffleArray(flashcardIndexArray);
            indexArrayFilledFlag = true;
            
//            for (var i = 0; i < 200; i++){
//                console.log (i +" : " +flashcardIndexArray[i]);
//            }
        }
   
        function shuffleArray(array) {
            for (var i = array.length - 1; i > 0; i--) {
                var j = Math.floor(Math.random() * (i + 1));
                var temp = array[i];
                array[i] = array[j];
                array[j] = temp;
            }
            return array;
        }    
    
    });                         
            
	</script>

    </head>
    <body>
        <div id="homepage" style="height:100%;" data-role="page" >

	<div data-role="header" data-position="fixed" data-tap-toggle="false">
		<h1>Top 1K Vocab</h1>                
	</div><!-- /header -->
       <div style="height:100%;" class="ui-content" data-role="main">	

	<audio id="audio" src="test.mp3" type="audio/mp3"></audio>
 
        
            <div class="ui-field-contain">
                    <fieldset data-role="controlgroup" data-mini="true">
                      <legend>Selecione Grupo de Palabras:</legend>
                        <label for="day">Selecione Grupo de Palabras:</label>
                        <select name="rankSelect" id="rankGroup" data-native-menu="false">
                          <option value="200">Rango 1-200</option>
                          <option value="400">Rango 201-400</option>
                          <option value="600">Rango 401-600</option>
                          <option value="800">Rango 601-800</option>
                          <option value="1000">Rango 801-1000</option>

                        </select>
                    </fieldset>
            <!--</div>-->        
          
          
            <div class="ui-grid-a" style="padding-top: 10px">
                <div class="ui-block-a"><input id="btnWords" type="button" data-inline="false" value="Ver Lista" data-mini="true" data-icon="bullets"></div>
                <div class="ui-block-b"><input id="btnFcards" type="button" data-inline="false" value="Flashcards" data-mini="true" data-icon="action"></div>
<!--            <a href="#word_list"  data-role="button" data-inline="true" data-mini="true" data-icon="bullets">Word List</a>
            <a href="#spanishflashcard"  data-role="button" data-inline="true" data-mini="true" data-icon="action">Flash Cards</a> -->
            </div>
            </div>
          
            <!--<div class="ui-grid-a">-->
<!--                <div class="ui-block-a"><input type="text" id="word" placeholder="Entre palabra en ingles.." data-mini="true"></div>
                <div class="ui-block-b"><input id="btnPlay" type="button" value="Pronounce Word" data-mini="true" data-icon="audio"></div>-->
            <!--</div>-->
            <div class="needConnection">
                <div><input type="text" id="word" placeholder="Entre palabra en ingles.." data-mini="true"></div>
                <div><input id="btnPlay" type="button" value="Pronunciar" data-mini="true" data-icon="audio"></div>
            </div>
        
        </div><!-- /content -->
        <div data-role="footer" data-position="fixed" data-tap-toggle="false">
            <div data-role="navbar" data-iconpos="bottom" >
                <ul >
                    <li><a href="#" data-icon="home">Home</a></li>
                <li><a href="#about_page" data-icon="info">About</a></li>
                </ul>
            </div>
        </div>
</div><!-- /page -->

<div id="about_page" data-role="page">

    <div data-role="header" data-position="fixed" data-tap-toggle="false">
        <h1>Top English Vob</h1>                
    </div>

    <div class="ui-content" data-role="main">
        Este app es para ayudar aprender las 1000 palabras mas comunes en  ingles.<br><br>
        1. Selectione grupo de palabras. Cada grupo es de 200 palabras. La de rango 1 es la mas comun.<br><br>
        2. "Ver Lista" le mostrara la lista de palabras en ingles y espanol. Haga click en la palabra para la pronunciacion.<br><br>
        3. "Flashcard" le mostrara las palabras en forma de targetas didacticas. <br><br>
        *"Prox" para avansar a lo proxima palabra<br>
        *"Prev" para ver la palabra previa<br>
        *"Pron.." para oir la pronunciacion<br>
        *"Voltear" para cambiar entre ingles y espanol<br><br>
        4. En la pagina principal puede entrar palabras en ingles y oir la pronunciacion.
        
    </div>
    
    <div data-role="footer" data-position="fixed" data-tap-toggle="false">
        <div data-role="navbar" data-iconpos="bottom">
            <ul>
                <li><a href="#homepage" data-icon="home">Home</a></li>
                <li><a href="#" data-icon="info">About</a></li>
            </ul>
        </div>
    </div>
</div>

<div id="word_list" data-role="page" >

    <div data-role="header" data-position="fixed" data-tap-toggle="false">
        <h1>Word List</h1> 
        <a href="#" data-icon="back" data-iconpos="notext" data-rel="back"></a>
        <a href="#homepage" data-icon="home" data-iconpos="notext" ></a>
         
    </div>
    <div  class="ui-content" data-role="main">
       
            <div id="wordGrid" class="ui-grid-a ui-body-a ui-corner-all" style="padding:5px; font-size: 1em;">
              <div class='ui-block-a ui-bar-a' ><span>Go To</span></div>
              <div class='ui-block-b ui-bar-a' ><span><a href="#homepage">Home Page</a></span></div>
              </div>
    </div>
    
    <div data-role="footer" data-position="fixed" data-tap-toggle="false">
        <div data-role="navbar" data-iconpos="bottom">
            <ul>
                <li><a href="#homepage" data-icon="home">Home</a></li>
                <li><a href="#about_page" data-icon="info">About</a></li>
            </ul>
        </div>
    </div>
</div>

<div id="spanishflashcard" data-role="page" >

    <div data-role="header" data-position="fixed" data-tap-toggle="false">
        <h1>Flash Cards</h1>  
        <a href="#" data-icon="back" data-iconpos="notext" data-rel="back"></a>
        <a href="#homepage" data-icon="home" data-iconpos="notext" ></a>
    </div>

    <div class="ui-content" data-role="main">
        
        <ul id="spanishSide" style="margin:10px;" class="ui-listview ui-corner-all" data-role="listview">
            <!--<li class="ui-li-divider ui-bar-a ui-first-child" data-form="ui-bar-a" data-swatch="a" data-theme="a" data-role="list-divider" role="heading"></li>-->
            <li style="text-align: center;" class="ui-li-divider ui-header ui-bar-a" data-role="list-divider" >Espanol</li>
            <li></li>
            <li id="spanishWord" style="text-align: center; font-size: 2em;">Spanish Word</li>
            <li></li>
        </ul>
        <p></p>
        <input class="btnFlip" type="button" data-mini="true" data-icon="action" value="Voltear Carta" data-iconpos="bottom">
    </div>
    
    <div data-role="footer" data-position="fixed" data-tap-toggle="false">
        <div data-role="navbar" data-iconpos="bottom">
            <ul>
                <li> <input id="btnPrev" type="button" value="Prev" data-mini="true" data-icon="arrow-l" data-iconpos="bottom"></li>
                <!--<li> <input id="btnPlayEng" type="button" value="Play" data-mini="true" data-icon="audio" data-iconpos="bottom"></li>-->
                <li> <input id="btnNext" type="button" value="Prox" data-mini="true" data-icon="arrow-r" data-iconpos="bottom"></li>
               
            </ul>
        </div>
    </div>
</div>

<div id="englishflashcard" data-role="page" >

    <div data-role="header" data-position="fixed" data-tap-toggle="false">
        <h1>Flash Cards</h1>  
        <a href="#" data-icon="back" data-iconpos="notext" data-rel="back"></a>
        <a href="#homepage" data-icon="home" data-iconpos="notext" ></a>
    </div>

    <div class="ui-content" data-role="main">
        
        <ul id="englishSide" style="margin:10px;" class="ui-listview ui-corner-all" data-role="listview">
           <li style="text-align: center;" class="ui-li-divider ui-header ui-bar-a" data-role="list-divider" >Ingles</li>
            <li></li>
            <li id="englishWord" style="text-align: center; font-size: 2em;">English Word</li>
            <li></li>
        </ul>
        <p></p>
        <input class="btnFlip" type="button" data-mini="true" data-icon="action" value="Voltear Carta" data-iconpos="bottom">
    </div>
    
    <div data-role="footer" data-position="fixed" data-tap-toggle="false">
        <div data-role="navbar" data-iconpos="bottom">
            <ul>
                <li> <input id="btnEPrev" type="button" value="Prev" data-mini="true" data-icon="arrow-l" data-iconpos="bottom"></li>
                <li > <input id="btnPlayEng"  type="button" value="Pronu.." data-mini="true" data-icon="audio" data-iconpos="bottom"></li>
                <li> <input id="btnENext" type="button" value="Prox" data-mini="true" data-icon="arrow-r" data-iconpos="bottom"></li>
                
            </ul>
        </div>
    </div>
</div>

<div id="loadingImg" style="position:fixed;left: 0;top: 0;width: 100%;height: 100%;padding:2px; background: transparent url('themes/images/ajax-loader.gif') center center no-repeat;"></div>
    </body>
</html>

